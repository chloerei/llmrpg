<div class="navbar shadow-xs sticky top-0 z-50 bg-base-100">
  <div class="flex-none">
    <a href="<%= rooms_path %>" class="btn btn-ghost btn-square">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-icon lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
    </a>
  </div>
  <div class="flex-1">
    <div class="text-xl px-2">
      <%= @room.name %>
    </div>
  </div>
  <div class="flex-none">
    <div class="dropdown dropdown-end">
      <label tabindex="0" class="btn btn-ghost btn-square">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis-vertical-icon lucide-ellipsis-vertical"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
      </label>
      <ul tabindex="0" class="dropdown-content menu bg-base-100 shadow-sm rounded-box w-40">
        <li>
          <a href="<%= edit_room_path(@room) %>">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
            Edit
          </a>
        </li>
        <li>
          <a href="<%= room_path(@room) %>" data-turbo-method="delete" data-turbo-confirm="Are you sure you want to delete this room and all conversation? This action cannot be undone.">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            Delete
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="max-w-3xl mx-auto p-4">
  <div class="">
    <div class="font-medium">
      Description
    </div>
    <div class="mt-2">
      <%= @room.description.presence || "No description provided." %>
    </div>
  </div>

  <div class="mt-4">
    <div class="font-medium">
      Members
    </div>
    <div class="mt-2">
      <% if @room.characters.any? %>
        <div class="flex items-center gap-2">
          <% playing_character = @room.characters.where(members: { playing: true }).first %>
          <% if playing_character %>
            <div class="border-4 border-base-300 rounded-full">
              <%= render "shared/avatar", character: playing_character %>
            </div>
          <% end %>

          <% characters = @room.characters.where(members: { playing: false }).order(members: { created_at: :asc }) %>
          <div class="avatar-group -space-x-6">
            <% characters.limit(5).each do |character| %>
              <%= render "shared/avatar", character: character %>
            <% end %>
            <% if characters.count > 5 %>
              <span class="avatar avatar-placeholder">
                <div class="bg-base-300 text-base-content rounded-full size-10">
                  <span class="text-xs">+<%= characters.count - 5 %></span>
                </div>
              </span>
            <% end %>
          </div>

          <a href="<%= room_members_path(@room) %>" class="btn btn-ghost btn-square">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-pen-icon lucide-user-pen"><path d="M11.5 15H7a4 4 0 0 0-4 4v2"/><path d="M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"/><circle cx="10" cy="7" r="4"/></svg>
          </a>
        </div>
      <% else %>
        <a href="<%= new_room_member_path(@room) %>" class="btn btn-soft">
          Add Member
        </a>
      <% end %>
    </div>
  </div>

  <div class="mt-4">
    <div class="font-medium">
      Conversations
    </div>

    <div class="mt-4">
      <%= form_with url: room_conversations_path(@room), method: :post do |form| %>
        <button type="submit" class="btn btn-soft">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-plus-icon lucide-message-square-plus"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M12 7v6"/><path d="M9 10h6"/></svg>
          New Conversation
        </button>
      <% end %>
    </div>

    <ul class="list mt-2">
      <% @room.conversations.order(id: :desc).each do |conversation| %>
        <li class="list-row hover:bg-base-200 relative">
          <div class="list-col-grow">
            <a href="<%= room_conversation_path(@room, conversation) %>" class="block after:absolute after:inset-0">
              <%= conversation.title.presence || "Untitled" %>
            </a>
          </div>
          <div class="">
            <span class="text-xs opacity-80">
              <%= conversation.created_at %>
            </span>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
</div>
